#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main() {
    int fd1[2], fd2[2];
    pid_t pid;

    // Création des pipes
    pipe(fd1);
    pipe(fd2);

    // Création du processus fils
    pid = fork();

    if (pid < 0) {
        printf("Erreur lors de la création du processus fils.\n");
        exit(1);
    }

    // Processus fils
    else if (pid == 0) {
        int nb_essais = 0;
        int secret = 5;
        int choix = 0;
        close(fd1[1]);
        close(fd2[0]);

        while (choix != secret && nb_essais < 10) {
            // Lecture du choix du joueur
            read(fd1[0], &choix, sizeof(choix));
            if (choix < secret) {
                write(fd2[1], "plus grand\n", 12);
            } else if (choix > secret) {
                write(fd2[1], "plus petit\n", 12);
            } else {
                write(fd2[1], "gagné\n", 7);
            }
            nb_essais++;
        }

        close(fd1[0]);
        close(fd2[1]);
        exit(0);
    }

    // Processus parent
    else {
        int nb_essais = 0;
        int choix = 0;
        close(fd1[0]);
        close(fd2[1]);

        while (choix != 5 && nb_essais < 10) {
            // Lecture du choix du joueur
            printf("Entrez un nombre entre 1 et 10 : ");
            scanf("%d", &choix);
            write(fd1[1], &choix, sizeof(choix));

            // Lecture de la réponse du fils
            char buffer[12];
            read(fd2[0], buffer, sizeof(buffer));
            printf("%s", buffer);

            nb_essais++;
        }

        close(fd1[1]);
        close(fd2[0]);
        exit(0);
    }

    return 0;
}