#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <semaphore.h>

#define N 10
#define P(v) sem_wait(&v)
#define V(v) sem_post(&v)

sem_t sem1;
sem_t sem2;

char tampon[N];
int indice_ecriture = 0;
int indice_lecture = 0;

// Fonction pour écrire dans le tampon
void ecrire_tampon(char data);

// Fonction pour lire dans le tampon
char lecture_tampon();

// Fonction pour le thread d'écriture
void *ecrivain(void *arg);

// Fonction pour le thread de lecture
void *lecteur(void *arg);

int main()
{
  sem_init(&sem1, 0, 1);
  sem_init(&sem2, 0, 1);
  P(sem2);
  pthread_t thread_ecrivain, thread_lecteur;
  pthread_create(&thread_ecrivain, NULL, ecrivain, NULL);
  pthread_create(&thread_lecteur, NULL, lecteur, NULL);
  pthread_join(thread_ecrivain, NULL);
  pthread_join(thread_lecteur, NULL);
  return 0;
}

// Fonction pour écrire dans le tampon
void ecrire_tampon(char data)
{
  tampon[indice_ecriture] = data;
  indice_ecriture = (indice_ecriture + 1) % N;
}

// Fonction pour lire dans le tampon
char lecture_tampon()
{
  char data = tampon[indice_lecture];
  tampon[indice_lecture] = '\0';
  indice_lecture = (indice_lecture + 1) % N;
  return data;
}

// Fonction pour le thread d'écriture
void *ecrivain(void *arg)
{
  char data;
  while (1)
  {
    P(sem1);
    printf("Entrez une donnée à écrire dans le tampon : ");
    scanf(" %c", &data);
    ecrire_tampon(data);
    V(sem2);
  }
  pthread_exit(NULL);
}

// Fonction pour le thread de lecture
void *lecteur(void *arg)
{
  char data;
  while (1)
  {
    P(sem2);
    data = lecture_tampon();
    printf("Donnée lue : %c\n", data);
    V(sem1);
  }
  pthread_exit(NULL);
}
